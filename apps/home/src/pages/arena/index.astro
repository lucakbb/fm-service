---
import { ARENA_AUTH } from "@consts";

// Basic authentication for arena access
function parseBasicAuth(authHeader: string | null): { username: string; password: string } | null {
  if (!authHeader || !authHeader.startsWith('Basic ')) {
    return null;
  }
  
  try {
    const credentials = atob(authHeader.slice(6));
    const [username, password] = credentials.split(':');
    return { username, password };
  } catch {
    return null;
  }
}

function requireAuth(request: Request): Response | null {
  const authHeader = request.headers.get('Authorization');
  const credentials = parseBasicAuth(authHeader);
  
  // Arena credentials
  const validUsername = ARENA_AUTH.USERNAME;
  const validPassword = ARENA_AUTH.PASSWORD;
  
  if (!credentials || credentials.username !== validUsername || credentials.password !== validPassword) {
    return new Response('Unauthorized', {
      status: 401,
      headers: {
        'WWW-Authenticate': 'Basic realm="Arena Access"',
        'Content-Type': 'text/plain'
      }
    });
  }
  
  return null;
}

// Check authentication
const authResult = requireAuth(Astro.request);
if (authResult) {
  return authResult;
}

export const prerender = false;
---

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script>
    window.location.href = '/arena/leaderboard';
  </script>
</head>
<body>
  <p>Redirecting to leaderboard...</p>
</body>
</html> 